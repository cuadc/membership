Hello,

This is an automated message from the CUADC Membership System. Please do
not reply.

Please see below for the weekly membership report for upcoming CUADC shows.

===== REPORT BEGINS =====
<% @shows.each do |show| %>
  <% people = show.roles.map(&:person).uniq(&:id) %>
  <% tuples = people.map { |p| [p, Member.find_by(camdram_id: p.id)] } %>
<%= "#{show.name}:" %>
  <% expired_tuples = tuples.select { |p| p[1].present? && p[1].mtype_id == 1 && p[1].expired? } %>
  <% if expired_tuples.length > 0 %>
  The following individuals' Memberships have expired and need renewing:
  <% end %>
  <% expired_tuples.each do |tuple| %>
    <%= tuple[0].name %>
  <% end %>

  <% non_member_tuples = tuples.select { |p| p[1].nil? || (p[1].present? && p[1].mtype_id != 1) } %>
  <% if expired_tuples.length == 0 && non_member_tuples.length == 0 %>
  Nothing to report.
  <% end %>
  <% if non_member_tuples.length > 0 %>
  The following individuals are not Ordinary Members:
  <% end %>
  <% non_member_tuples.each do |tuple| %>
    <%= "* #{tuple[0].name}" %>
  <% end %>



<% end %>
===== REPORT ENDS =====

I have the honour to be your obedient servant,

The CUADC Membership System
