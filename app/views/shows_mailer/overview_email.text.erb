Hello,

This is an automated message from the CUADC Membership System. Please do
not reply.

Please see below for the weekly membership report for upcoming CUADC
shows. As per the constitution, only Ordinary Members are allowed to
participate in Club Shows. Please remind producers that those in named
roles must signup for membership at the earliest opportunity, or contact
the Committee if they are experiencing issues in so doing.

===== REPORT BEGINS =====
<% @shows.each do |show| %>
  <% people = show.roles.map(&:person).uniq(&:id) %>
  <% tuples = people.map { |p| [p, Member.find_by(camdram_id: p.id)] } %>
<%= "#{show.name}:" %>
  <% expired_tuples = tuples.select { |p| p[1].present? && p[1].mtype_id == 1 && p[1].expired? } %>
  <% if expired_tuples.length > 0 %>
  The following individuals' Memberships have expired and need renewing:
  <% expired_tuples.each do |tuple| %>
    <%= "* #{tuple[0].name}" %>
  <% end %>
  <% end %>
  <% non_member_tuples = tuples.select { |p| p[1].nil? || (p[1].present? && p[1].mtype_id != 1) } %>
  <% if non_member_tuples.length > 0 %>
  <% if expired_tuples.length > 0 %>

  <% end %>
  The following individuals are not Ordinary Members:
  <% non_member_tuples.each do |tuple| %>
    <%= "* #{tuple[0].name}" %>
  <% end %>
  <% end %>
  <% if expired_tuples.length == 0 && non_member_tuples.length == 0 %>
  Nothing to report.
  <% end %>



<% end %>
===== REPORT ENDS =====

I have the honour to be your obedient servant,

The CUADC Membership System
